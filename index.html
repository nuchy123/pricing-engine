  <meta charset="UTF-8" />
  <title>Mortgage Pricing Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- SheetJS for Excel (.xlsx recommended) -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.19.3/dist/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f3f4f6;
    }
    .card {
      background: white;
      border-radius: 1rem;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.08);
      padding: 1.5rem;
    }
    .label {
      font-size: 0.85rem;
      color: #4b5563;
      font-weight: 500;
      margin-bottom: 0.1rem;
      display: block;
    }
    .input, select {
      border-radius: 0.75rem;
      border: 1px solid #d1d5db;
      padding: 0.4rem 0.75rem;
      width: 100%;
      font-size: 0.9rem;
    }
    .input:focus, select:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 1px #2563eb22;
    }
    .primary-btn {
      background: linear-gradient(135deg, #2563eb, #1d4ed8);
      color: white;
      border-radius: 999px;
      padding: 0.6rem 1.5rem;
      font-weight: 600;
      font-size: 0.95rem;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }
    .primary-btn:hover {
      filter: brightness(1.05);
    }
    .badge {
      display: inline-flex;
      align-items: center;
      border-radius: 999px;
      padding: 0.15rem 0.6rem;
      font-size: 0.7rem;
      font-weight: 500;
    }
    .badge-blue {
      background: #e0ebff;
      color: #1d4ed8;
    }
    .badge-green {
      background: #dcfce7;
      color: #166534;
    }
  </style>
</head>
<body class="min-h-screen">
  <div class="max-w-6xl mx-auto px-4 py-6">
    <!-- Header -->
    <header class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
      <div>
        <h1 class="text-2xl md:text-3xl font-bold text-slate-900">Mortgage Pricing Hub</h1>
        <p class="text-sm text-slate-600 mt-1">
          Simple, user-friendly pricing: only note rate &amp; monthly P&amp;I shown to the front end.



        </p>
      </div>
      <div class="flex flex-wrap gap-2">
        <span class="badge badge-blue">Conventional / HP / HR / HB</span>
        <span class="badge badge-green">Admin XLSX Upload</span>





      </div>
    </header>

    <!-- Admin panel (only ?admin=1) -->
    <section id="admin-panel" class="mb-6 hidden">
      <div class="card border border-dashed border-blue-200 bg-blue-50/40">
        <div class="flex items-start gap-3">
          <div class="mt-1 text-blue-600">⚙️</div>
          <div class="flex-1">
            <h2 class="text-lg font-semibold text-slate-900 mb-1">
              Admin – Upload Daily TPO Go Rate Sheet
            </h2>
            <p class="text-xs text-slate-600 mb-3">
              Upload a clean <strong>.xlsx</strong> version of the TPO Go rate sheet. 
              (If you have .xls, first open it in Excel or Google Sheets and save/download as .xlsx.)






            </p>


            <div class="flex flex-col md:flex-row gap-3 items-start md:items-center">
              <div class="flex-1 min-w-[220px]">
                <label class="label">Rate Sheet (.xlsx)</label>
                <input id="rateSheetFile" type="file" accept=".xlsx" class="input bg-white" />
              </div>
              <button id="parseSheetBtn" class="primary-btn mt-2 md:mt-6">
                <span>Load Pricing</span>
              </button>
            </div>

            <p id="adminStatus" class="text-xs mt-3 text-slate-600"></p>










            <p class="text-[0.7rem] mt-3 text-slate-500">
              Current version: Parses the Conforming 30-Year Fixed grid (30-day) from the first sheet that 
              contains "CONVENTIONAL PRICING" in a row. LLPA &amp; payup functions are present but currently
              return 0 until we fill them with the real tables.
            </p>






          </div>
        </div>
      </div>
    </section>

    <!-- Main layout -->
    <div class="grid md:grid-cols-5 gap-5">
      <!-- Input form -->
      <section class="md:col-span-2">
        <div class="card">
          <h2 class="text-lg font-semibold text-slate-900 mb-2">Scenario Details</h2>
          <p class="text-xs text-slate-500 mb-4">
            Fill in the basic loan scenario. LTV and location are calculated automatically to keep it
            simple for Realtors and borrowers.
          </p>

          <form id="pricingForm" class="space-y-4">
            <!-- Program & Lock -->
            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="label" for="program">Program</label>
                <select id="program">
                  <option value="conv30">Conforming 30 Year Fixed</option>
                  <option value="conv20">Conforming 20 Year Fixed</option>
                  <option value="conv15">Conforming 15 Year Fixed</option>
                  <option value="conv10">Conforming 10 Year Fixed</option>
                  <option value="hp30">Home Possible 30 Year</option>
                  <option value="hp20">Home Possible 20 Year</option>
                  <option value="hr30">HomeReady 30 Year</option>
                  <option value="hr15">HomeReady 15 Year</option>
                  <option value="hb30">High Balance 30 Year</option>
                  <option value="hb15">High Balance 15 Year</option>
                  <option value="homestyle">HomeStyle 30 Year (DU Only)</option>
                </select>
              </div>
              <div>
                <label class="label" for="lockTerm">Lock Term</label>
                <select id="lockTerm">
                  <option value="30">30 Days</option>
                  <option value="15">15 Days</option>
                  <option value="45">45 Days</option>
                  <option value="60">60 Days</option>
                </select>
              </div>
            </div>

            <!-- Occupancy & Property Type -->
            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="label" for="occupancy">Occupancy</label>
                <select id="occupancy">
                  <option value="primary">Primary Residence</option>
                  <option value="second">Second Home</option>
                  <option value="investment">Investment Property</option>
                </select>
              </div>
              <div>
                <label class="label" for="propertyType">Property Type</label>
                <select id="propertyType">
                  <option value="sfr">Single Family / PUD</option>
                  <option value="2-4">2–4 Unit</option>
                  <option value="condo">Condo</option>
                  <option value="manufactured">Manufactured</option>
                  <option value="coop">Co-op</option>
                </select>
              </div>
            </div>

            <!-- FICO & Purpose -->
            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="label" for="fico">FICO</label>
                <select id="fico">
                  <option value="780">780+</option>
                  <option value="760">760–779</option>
                  <option value="740">740–759</option>
                  <option value="720">720–739</option>
                  <option value="700">700–719</option>
                  <option value="680">680–699</option>
                  <option value="660">660–679</option>
                  <option value="640">640–659</option>
                  <option value="620">620–639</option>
                  <option value="600">&lt;620</option>
                </select>
              </div>
              <div>
                <label class="label" for="purpose">Loan Purpose</label>
                <select id="purpose">
                  <option value="purchase">Purchase</option>
                  <option value="rt">Rate / Term Refi</option>
                  <option value="cashout">Cash-Out Refi</option>
                </select>
              </div>
            </div>

            <!-- ZIP & Location -->
            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="label" for="zip">ZIP Code</label>
                <input id="zip" class="input" type="text" maxlength="5" placeholder="e.g. 11230" />
              </div>
              <div>
                <label class="label">Location (auto)</label>
                <div class="text-xs text-slate-700">
                  <span id="cityDisplay">–</span>,
                  <span id="stateDisplay">–</span>
                  <span class="text-slate-500">(County: <span id="countyDisplay">–</span>)</span>
                </div>
              </div>
            </div>

            <!-- Purchase Price / Loan Amount / LTV -->
            <div class="grid grid-cols-3 gap-3">
              <div>
                <label class="label" for="purchasePrice">Purchase Price</label>
                <input id="purchasePrice" class="input" type="number" min="0" step="1000" placeholder="e.g. 700000" />
              </div>
              <div>
                <label class="label" for="loanAmount">Loan Amount</label>
                <input id="loanAmount" class="input" type="number" min="0" step="1000"
                       placeholder="Enter or auto" />
              </div>
              <div>
                <label class="label" for="ltv">LTV (%)</label>
                <input id="ltv" class="input" type="number" min="0" max="200" step="0.01"
                       placeholder="Enter or auto" />
              </div>
            </div>

            <p class="text-[0.7rem] text-slate-500">
              Either enter <strong>Purchase Price + Loan Amount</strong> and LTV will auto-fill,
              or <strong>Purchase Price + LTV</strong> and Loan Amount will auto-fill.
            </p>

            <div class="pt-3">
              <button type="submit" class="primary-btn">
                <span>Get Pricing</span> <span>➜</span>
              </button>
            </div>
          </form>
        </div>
      </section>

      <!-- Results -->
      <section class="md:col-span-3">
        <div class="card h-full flex flex-col">
          <h2 class="text-lg font-semibold text-slate-900 mb-2">Pricing Result</h2>
          <p class="text-xs text-slate-500 mb-4">
            We only show the <strong>note rate</strong> and <strong>principal &amp; interest payment</strong>.
            All price, LLPA, payup incentives, and broker compensation are applied internally (for now LLPA/payups = 0).
          </p>

          <div id="resultArea"
               class="flex-1 flex flex-col items-center justify-center text-center text-slate-500">
            <p class="text-sm mb-1">No scenario calculated yet.</p>
            <p class="text-xs">Fill in the form and click <strong>Get Pricing</strong>.</p>

          </div>











        </div>
      </section>
    </div>
  </div>

  <script>
    let conventionalBaseGrid = [];
    const pricingGrids = {};
    const BROKER_COMP_PERCENT = 2.5;

    function isAdminMode() {
      const params = new URLSearchParams(window.location.search);
      return params.get("admin") === "1";
    }

    document.addEventListener("DOMContentLoaded", () => {
      if (isAdminMode()) {
        document.getElementById("admin-panel").classList.remove("hidden");
      }
      setupAdminUpload();
      setupZipAutoLookup();
      setupLtvAutoCalc();
      setupPricingForm();
    });

    /**** ADMIN UPLOAD (.XLSX) ****/
    function setupAdminUpload() {
      const fileInput = document.getElementById("rateSheetFile");
      const btn = document.getElementById("parseSheetBtn");
      const statusEl = document.getElementById("adminStatus");
      if (!fileInput || !btn) return;

      btn.addEventListener("click", () => {
        if (!fileInput.files || fileInput.files.length === 0) {
          statusEl.textContent = "Please choose a .xlsx file first.";
          statusEl.className = "text-xs mt-3 text-red-600";
          return;
        }

        const file = fileInput.files[0];
        const reader = new FileReader();

        reader.onload = function(e) {
          try {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, { type: "array" });

            conventionalBaseGrid = extractConventional30Grid(workbook);
            pricingGrids["conv30"] = conventionalBaseGrid;

            if (!conventionalBaseGrid.length) {
              statusEl.textContent =
                "Workbook loaded, but could not locate a 'CONVENTIONAL PRICING' 30-year grid. Check that this tab exists.";
              statusEl.className = "text-xs mt-3 text-yellow-600";
            } else {
              statusEl.textContent =
                Loaded Conforming 30Y pricing (30-day) from ${file.name} – ${conventionalBaseGrid.length} rows captured.;
              statusEl.className = "text-xs mt-3 text-green-700";
            }
          } catch (err) {
            console.error(err);
            statusEl.textContent = "Error reading workbook (not a clean .xlsx or corrupted). Try saving through Excel/Google Sheets as .xlsx and re-upload.";
            statusEl.className = "text-xs mt-3 text-red-600";
          }
        };

        reader.readAsArrayBuffer(file);
      });
    }

    function extractConventional30Grid(workbook) {
      const rowsBySheet = [];


      workbook.SheetNames.forEach(name => {
        const sheet = workbook.Sheets[name];
        const rows = XLSX.utils.sheet_to_json(sheet, { header: 1, defval: "" });
        rowsBySheet.push({ name, rows });
      });

      // Find the first sheet that contains "CONVENTIONAL PRICING"
      let chosen = null;
      for (const s of rowsBySheet) {
        const idx = s.rows.findIndex(r => r.join(" ").toUpperCase().includes("CONVENTIONAL PRICING"));
        if (idx !== -1) {
          chosen = { sheetName: s.name, rows: s.rows, startIndex: idx };
          break;
        }
      }
      if (!chosen) return [];

      const rows = chosen.rows;
      const startIdx = chosen.startIndex;

      let headerRowIndex = -1, rateCol = -1, col30 = -1;
      for (let i = startIdx; i < rows.length; i++) {
        const row = rows[i].map(c => String(c).trim());
        const upper = row.map(c => c.toUpperCase());
        if (upper.includes("RATE") && upper.some(c => c.includes("30"))) {
          headerRowIndex = i;
          rateCol = upper.indexOf("RATE");
          col30 = upper.findIndex(c => c.includes("30"));
          break;
        }
      }
      if (headerRowIndex === -1 || rateCol === -1 || col30 === -1) return [];

      const grid = [];
      for (let i = headerRowIndex + 1; i < rows.length; i++) {
        const row = rows[i];
        const rawRate = row[rateCol];
        if (!rawRate || String(rawRate).trim() === "") break;
        const rate = parseFloat(String(rawRate).replace(/[^\d.]/g, ""));
        const price30 = parseFloat(String(row[col30]).replace(/[^\d.-]/g, ""));
        if (isNaN(rate) || isNaN(price30)) continue;
        grid.push({ rate, price30 });
      }
      return grid;
    }

    /**** ZIP LOOKUP ****/
    function setupZipAutoLookup() {
      const zipInput = document.getElementById("zip");
      const cityEl = document.getElementById("cityDisplay");
      const stateEl = document.getElementById("stateDisplay");
      const countyEl = document.getElementById("countyDisplay");
      if (!zipInput) return;

      let zipTimeout = null;
      zipInput.addEventListener("input", () => {
        const zip = zipInput.value.trim();
        if (!/^\d{5}$/.test(zip)) {
          cityEl.textContent = "–";
          stateEl.textContent = "–";
          countyEl.textContent = "–";
          return;
        }
        if (zipTimeout) clearTimeout(zipTimeout);
        zipTimeout = setTimeout(() => {
          fetch(https://api.zippopotam.us/us/${zip})
            .then(res => {
              if (!res.ok) throw new Error();
              return res.json();
            })
            .then(data => {
              const place = data.places && data.places[0];
              const city = place ? place["place name"] : "";
              const stateAbbr = place ? place["state abbreviation"] : "";
              cityEl.textContent = city || "Unknown city";
              stateEl.textContent = stateAbbr || "Unknown state";
              countyEl.textContent = "N/A";
              window.currentPricingZone = getZoneForStateAndZip(stateAbbr, zip);
            })
            .catch(() => {
              cityEl.textContent = "–";
              stateEl.textContent = "–";
              countyEl.textContent = "–";
              window.currentPricingZone = 0;
            });
        }, 300);
      });
    }

    function getZoneForStateAndZip(stateAbbr, zip) {
      const zoneByState = { "NY": 1, "NJ": 2, "CT": 3, "FL": 4, "CA": 5 };
      return zoneByState[stateAbbr] || 0;






















    }

    /**** LTV AUTO CALC ****/
    function setupLtvAutoCalc() {
      const pp = document.getElementById("purchasePrice");
      const la = document.getElementById("loanAmount");
      const ltv = document.getElementById("ltv");
      if (!pp || !la || !ltv) return;

      function recalcFromLoanAmount() {
        const purchase = parseFloat(pp.value);
        const loan = parseFloat(la.value);
        if (purchase > 0 && loan > 0) {
          const pct = (loan / purchase) * 100;
          ltv.value = pct.toFixed(2);
        }
      }
      function recalcFromLtv() {
        const purchase = parseFloat(pp.value);
        const ltvPct = parseFloat(ltv.value);
        if (purchase > 0 && ltvPct > 0) {
          const loan = purchase * (ltvPct / 100);
          la.value = Math.round(loan / 100) * 100;















        }

      }

      pp.addEventListener("input", () => {
        if (la.value) recalcFromLoanAmount();
        else if (ltv.value) recalcFromLtv();
      });
      la.addEventListener("input", recalcFromLoanAmount);
      ltv.addEventListener("input", recalcFromLtv);
    }

    /**** PRICING ENGINE ****/
    function setupPricingForm() {
      const form = document.getElementById("pricingForm");
      const resultArea = document.getElementById("resultArea");
      if (!form || !resultArea) return;








      form.addEventListener("submit", (e) => {
        e.preventDefault();

















        const program = document.getElementById("program").value;
        const occupancy = document.getElementById("occupancy").value;
        const propertyType = document.getElementById("propertyType").value;
        const fico = parseInt(document.getElementById("fico").value, 10);
        const purpose = document.getElementById("purpose").value;
        const purchasePrice = parseFloat(document.getElementById("purchasePrice").value);
        const loanAmount = parseFloat(document.getElementById("loanAmount").value);
        const ltv = parseFloat(document.getElementById("ltv").value);
        const stateAbbr = document.getElementById("stateDisplay").textContent;
        const zone = window.currentPricingZone || 0;

        if (!loanAmount || !purchasePrice || loanAmount <= 0 || purchasePrice <= 0) {
          resultArea.innerHTML =
            <p class="text-sm text-red-600">Please enter a valid Purchase Price and Loan Amount (or LTV).</p>;
          return;
        }

        if (!conventionalBaseGrid.length) {
          resultArea.innerHTML =
            <p class="text-sm text-red-600">No pricing grid loaded. Go to <strong>?admin=1</strong> and upload the daily rate sheet (.xlsx).</p>;
          return;
        }




        let baseRows = pricingGrids[program];
        if (!baseRows || !baseRows.length) baseRows = conventionalBaseGrid;

        const isHomeStyle = (program === "homestyle");

        if (isHomeStyle) {
          const duQuote = buildQuoteFromGrid({
            label: "Fannie Mae DU Eligible",
            program,
            baseRows,
            loanAmount,
            ltv,
            fico,
            occupancy,
            propertyType,
            purpose,
            stateAbbr,
            zone,
            payupFlavor: "DU"
          });
          if (!duQuote) {
            resultArea.innerHTML =
              <p class="text-sm text-red-600">No DU pricing available for this HomeStyle scenario.</p>;
            return;
          }
          resultArea.innerHTML = renderSingleCardHtml(duQuote);
          return;
        }

        const lpQuote = buildQuoteFromGrid({
          label: "Fannie Mae LP Eligible",
          program,
          baseRows,
          loanAmount,
          ltv,
          fico,
          occupancy,
          propertyType,
          purpose,
          stateAbbr,
          zone,
          payupFlavor: "LP"
        });
        const duQuote = buildQuoteFromGrid({
          label: "Fannie Mae DU Eligible",
          program,
          baseRows,
          loanAmount,
          ltv,
          fico,
          occupancy,
          propertyType,
          purpose,
          stateAbbr,
          zone,
          payupFlavor: "DU"
        });

        if (!lpQuote && !duQuote) {
          resultArea.innerHTML =
            <p class="text-sm text-red-600">No executable pricing found for this scenario.</p>;
          return;
        }
        resultArea.innerHTML = renderDualCardsHtml(lpQuote, duQuote);
      });
    }

    function buildQuoteFromGrid({
      label,
      program,
      baseRows,
      loanAmount,
      ltv,
      fico,
      occupancy,
      propertyType,
      purpose,
      stateAbbr,
      zone,
      payupFlavor
    }) {
      if (!baseRows || !baseRows.length) return null;

      const row = baseRows.slice().sort((a, b) => a.rate - b.rate)[0];
      if (!row) return null;

      const baseRate = row.rate;
      const basePrice = row.price30;

      const llpaAdj = getLlpaAdjustment({
        program,
        ltv,
        fico,
        occupancy,
        propertyType,
        purpose,
        stateAbbr,
        zone
      });

      const payupAdj = getPayupAdjustment({
        program,
        rate: baseRate,
        occupancy,
        stateAbbr,
        payupFlavor
      });

      const finalPrice = basePrice + BROKER_COMP_PERCENT + payupAdj - llpaAdj;
      const termYears = getProgramTermYears(program);
      const payment = calculateMonthlyPayment(loanAmount, baseRate, termYears);

      return {
        label,
        program,
        rate: baseRate,
        price: finalPrice,
        payment,
        loanAmount,
        termYears
      };
    }

    function getProgramTermYears(program) {
      if (program === "conv15" || program === "hr15" || program === "hb15") return 15;
      if (program === "conv20" || program === "hp20") return 20;
      return 30;
    }

    // Placeholders – safe (no adjustments) until we wire real tables
    function getLlpaAdjustment({ program, ltv, fico, occupancy, propertyType, purpose, stateAbbr, zone }) {
      return 0;
    }

    function getPayupAdjustment({ program, rate, occupancy, stateAbbr, payupFlavor }) {
      if (program === "hb30" || program === "hb15") return 0; // no payups for HB
      // if DU has no payup row in future table, treat as 0, but still price DU.
      return 0;
    }

    function calculateMonthlyPayment(loanAmount, annualRate, termYears) {
      const r = (annualRate / 100) / 12;
      const n = termYears * 12;
      if (r <= 0) return loanAmount / n;
      return loanAmount * (r / (1 - Math.pow(1 + r, -n)));
    }

    /**** RENDERING ****/
    function renderSingleCardHtml(q) {
      const rateStr = q.rate.toFixed(3) + "%";
      const payStr = "$" + q.payment.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");

      return `
        <div class="w-full flex flex-col items-center justify-center">
          <div class="max-w-md w-full mx-auto">
            <div class="border border-slate-200 rounded-2xl px-5 py-4 shadow-sm bg-gradient-to-br from-white to-slate-50">
              <div class="flex items-center justify-between mb-2">
                <div class="text-xs font-semibold text-slate-500 uppercase tracking-wide">
                  ${q.label}
                </div>
              </div>
              <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                <div class="text-left">
                  <div class="text-xs text-slate-500">Note Rate</div>
                  <div class="text-2xl font-bold text-slate-900">${rateStr}</div>
                </div>
                <div class="text-left sm:text-right">
                  <div class="text-xs text-slate-500">Monthly Payment (P&amp;I only)</div>
                  <div class="text-xl font-semibold text-emerald-700">${payStr}</div>
                </div>
              </div>
              <p class="text-[0.7rem] text-slate-500 mt-3">
                Internal price, LLPA, incentives, and broker compensation are applied but not shown here.
              </p>
            </div>
          </div>
        </div>
      `;
    }

    function renderDualCardsHtml(lp, du) {
      const lpAvailable = !!lp;
      const duAvailable = !!du;

      const lpRate = lpAvailable ? lp.rate.toFixed(3) + "%" : "–";
      const duRate = duAvailable ? du.rate.toFixed(3) + "%" : "–";
      const lpPay = lpAvailable
        ? "$" + lp.payment.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")
        : "No pricing available";
      const duPay = duAvailable
        ? "$" + du.payment.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")
        : "No pricing available";

      return `
        <div class="w-full">
          <p class="text-xs text-slate-600 mb-4 text-left">
            Showing separate Freddie Mac (LP) and Fannie Mae (DU) eligible pricing for this scenario.
          </p>
          <div class="grid md:grid-cols-2 gap-4">
            <div class="border border-slate-200 rounded-2xl px-5 py-4 shadow-sm bg-gradient-to-br from-white to-slate-50">
              <div class="text-xs font-semibold text-slate-500 uppercase tracking-wide mb-1">
                Fannie Mae LP Eligible
              </div>
              <div class="flex flex-col gap-3">
                <div>
                  <div class="text-xs text-slate-500">Note Rate</div>
                  <div class="text-2xl font-bold text-slate-900">${lpRate}</div>
                </div>
                <div>
                  <div class="text-xs text-slate-500">Monthly Payment (P&amp;I only)</div>
                  <div class="text-xl font-semibold text-emerald-700">
                    ${lpAvailable ? lpPay : <span class="text-red-600">${lpPay}</span>}
                  </div>
                </div>
              </div>
              <p class="text-[0.7rem] text-slate-500 mt-3">
                Payups and LLPA for LP are applied internally (except High Balance, which has no payups).
              </p>
            </div>

            <div class="border border-slate-200 rounded-2xl px-5 py-4 shadow-sm bg-gradient-to-br from-white to-slate-50">
              <div class="text-xs font-semibold text-slate-500 uppercase tracking-wide mb-1">
                Fannie Mae DU Eligible
              </div>
              <div class="flex flex-col gap-3">
                <div>
                  <div class="text-xs text-slate-500">Note Rate</div>
                  <div class="text-2xl font-bold text-slate-900">${duRate}</div>
                </div>
                <div>
                  <div class="text-xs text-slate-500">Monthly Payment (P&amp;I only)</div>
                  <div class="text-xl font-semibold text-emerald-700">
                    ${duAvailable ? duPay : <span class="text-red-600">${duPay}</span>}
                  </div>
                </div>
              </div>
              <p class="text-[0.7rem] text-slate-500 mt-3">
                DU pricing still shows even if no DU payup exists; in that case payup is treated as 0.
              </p>
            </div>
          </div>





        </div>
      `;
    }



































  </script>
</body>
</html>
